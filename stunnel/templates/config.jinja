{% set stunnel = salt['pillar.get']('stunnel:config', {}) -%}
{% from "stunnel/map.jinja" import stunnel as stunnel_map with context -%}
{% from "stunnel/templates/service.jinja" import service_segment -%}
# THIS FILE IS MANAGED BY SALT. DO NOT EDIT DIRECTLY
# defaults passed via context from map.jinja

{% if stunnel_map.use_chroot %}
chroot = {{ stunnel.get('home', default_home) }}
{% endif %}
pid = {{ pid }}

setuid = {{ stunnel.get('user', default_user) }}
setgid = {{ stunnel.get('group', default_group) }}

debug = {{ stunnel.get('debug', 'notice') }}

sslVersion = {{ stunnel.get('sslVersion', "all") }}
ciphers = {{ stunnel.get('ciphers', 'ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-DSS-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDH-RSA-AES256-GCM-SHA384:ECDH-ECDSA-AES256-GCM-SHA384:AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256:ECDH-RSA-AES128-GCM-SHA256:ECDH-ECDSA-AES128-GCM-SHA256:AES128-GCM-SHA256') }}

{%- if 'cert' in stunnel %}
cert = {{ stunnel.cert }}
{%- endif %}
{%- if 'key' in stunnel %}
key = {{ stunnel.key }}
{%- endif %}
{%- if 'ca' in stunnel %}
CAfile = {{ stunnel.ca }}
{%- endif %}
{%- if stunnel.get('verify', False) != False %}
verify = {{ stunnel.get('verify', '3') }}
{%- endif %}
{%- if stunnel.get('verifyChain', 'not_set') != 'not_set' %}
verifyChain = {{ 'yes' if stunnel.get('verifyChain') else 'no' }}
{%- endif %}
{%- if stunnel.get('verifyPeer', 'not_set') != 'not_set' %}
verifyPeer = {{ 'yes' if stunnel.get('verifyPeer') else 'no' }}
{%- endif %}

{% for option in stunnel.get('options', []) -%}
options = {{ option }}
{% endfor %}

{% if grains['os_family'] == 'FreeBSD' -%}
include = /usr/local/etc/stunnel/conf.d
{% else -%}
{{ service_segment(service) }}
{% endif -%}
